<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>algo trading | Matthew Smith R Shenanigans</title>
    <link>/tags/algo-trading/</link>
      <atom:link href="/tags/algo-trading/index.xml" rel="self" type="application/rss+xml" />
    <description>algo trading</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><lastBuildDate>Sun, 02 Feb 2020 00:00:00 +0000</lastBuildDate>
    <image>
      <url>/img/icon-192.png</url>
      <title>algo trading</title>
      <link>/tags/algo-trading/</link>
    </image>
    
    <item>
      <title>Machine Learning (XGBoost) Time-Series Classification Trading Strategy</title>
      <link>/post/xgboost-time-series-classification-trading-strategy/xgboost-time-series-quant-trading-strategy/</link>
      <pubDate>Sun, 02 Feb 2020 00:00:00 +0000</pubDate>
      <guid>/post/xgboost-time-series-classification-trading-strategy/xgboost-time-series-quant-trading-strategy/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;


&lt;div id=&#34;introduction&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Introduction&lt;/h1&gt;
&lt;p&gt;Using Machine Learning (ML) and past price data to predict the next periods price or direction in the stock market is not new, neither does it produce any meaningful predictions. In this post I &lt;em&gt;collapse&lt;/em&gt; down a series of asset time series data into a simple classification problem and see if a Machine Learning model can do a better job at predicting the next periods direction. I apply a similar method here &lt;a href=&#34;https://lf0.com/post/synth-real-time-series/financial-time-series/&#34;&gt;Time Series Classification Synthetic vs Real Financial Time Series&lt;/a&gt;. The &lt;strong&gt;objective&lt;/strong&gt; and &lt;strong&gt;strategy&lt;/strong&gt; is to invest in a single asset each day. The asset we invest in will be the asset which the Machine Learning model is most &lt;em&gt;confident&lt;/em&gt; will go up in share value in the next period &lt;span class=&#34;math inline&#34;&gt;\(t+1\)&lt;/span&gt;. Alternatively speaking, we invest in the asset in which the Machine Learning model gives the highest predicted probability that, a given asset will go up in value tomorrow. That is, if the model predicts on day &lt;span class=&#34;math inline&#34;&gt;\(t\)&lt;/span&gt; that asset GOOG was going to be higher than it’s previous close with a predicted probability of 0.78 and it also predicts that AMZN would go up with 0.53 probability then we would invest in GOOG today. -&lt;em&gt;we only invest in one asset each day&lt;/em&gt;- . The model can be expanded to short selling and multi-asset purchasing and multi-periods.&lt;/p&gt;
&lt;div id=&#34;load-in-the-packages.&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Load in the packages.&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(PerformanceAnalytics)
library(data.table)
library(dplyr)
library(tibble)
library(TTR)
library(tidyr)
library(tidyquant)
library(tsfeatures)
library(rsample)
library(purrr)
library(stringr)
library(tibbletime) # tsibble clashes with the base R index() function
library(xgboost)
library(rvest)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pre-define a few intialisation objects and set the ticker symbols of the companies we want to download. For this task I am not really interested in which companies I apply the strategy to. For this reason, I scrape the Wikipedia page for the S&amp;amp;P 500 and take a random sample of 30 tickers.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;set.seed(1234)
###################### Pre-define functions for later ##########################

Scale_Me &amp;lt;- function(x){
  (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)
}                                  # Note: I don&amp;#39;t actually use this function but I leave it in here.

#################################################################################

start_date &amp;lt;- &amp;quot;2017-01-01&amp;quot;
end_date &amp;lt;- &amp;quot;2020-01-01&amp;quot;

url &amp;lt;- &amp;quot;https://en.wikipedia.org/wiki/List_of_S%26P_500_companies&amp;quot;
symbols &amp;lt;- url %&amp;gt;%
  read_html() %&amp;gt;%
  html_nodes(xpath = &amp;#39;//*[@id=&amp;quot;constituents&amp;quot;]&amp;#39;) %&amp;gt;% 
  html_table() %&amp;gt;% 
  .[[1]] %&amp;gt;% 
  filter(!str_detect(Security, &amp;quot;Class A|Class B|Class C&amp;quot;)) %&amp;gt;%     # Removes firms with Class A, B &amp;amp; C shares
  sample_n(30) %&amp;gt;% 
  pull(Symbol)


#symbols &amp;lt;- c(
  #&amp;#39;GOOG&amp;#39;, &amp;#39;MSFT&amp;#39;, &amp;#39;HOG&amp;#39;, &amp;#39;AAPL&amp;#39;, &amp;#39;FB&amp;#39; 
  #&amp;#39;AMZN&amp;#39;, &amp;#39;EBAY&amp;#39;, &amp;#39;IBM&amp;#39;, &amp;#39;NFLX&amp;#39;, &amp;#39;NVDA&amp;#39;,
  #&amp;#39;TWTR&amp;#39;, &amp;#39;WMT&amp;#39;, &amp;#39;XRX&amp;#39;, &amp;#39;INTC&amp;#39;, &amp;#39;HPE&amp;#39;
# )&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;the-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;The data&lt;/h2&gt;
&lt;p&gt;Download the data and store it into a new environment.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dataEnv &amp;lt;- new.env()
getSymbols(symbols, 
           from = start_date, 
           to = end_date, 
           #src = &amp;quot;yahoo&amp;quot;, 
           #adjust = TRUE, 
           env = dataEnv)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;LEG&amp;quot;  &amp;quot;NLSN&amp;quot; &amp;quot;SLB&amp;quot;  &amp;quot;CHTR&amp;quot; &amp;quot;C&amp;quot;    &amp;quot;REGN&amp;quot; &amp;quot;CCI&amp;quot;  &amp;quot;SYK&amp;quot;  &amp;quot;ROP&amp;quot;  &amp;quot;RL&amp;quot;  
## [11] &amp;quot;CERN&amp;quot; &amp;quot;CMG&amp;quot;  &amp;quot;GS&amp;quot;   &amp;quot;CAT&amp;quot;  &amp;quot;MSI&amp;quot;  &amp;quot;BR&amp;quot;   &amp;quot;VRSK&amp;quot; &amp;quot;PNC&amp;quot;  &amp;quot;KEYS&amp;quot; &amp;quot;PHM&amp;quot; 
## [21] &amp;quot;FB&amp;quot;   &amp;quot;BKR&amp;quot;  &amp;quot;ABMD&amp;quot; &amp;quot;WYNN&amp;quot; &amp;quot;DG&amp;quot;   &amp;quot;ADI&amp;quot;  &amp;quot;GL&amp;quot;   &amp;quot;TSCO&amp;quot; &amp;quot;FLS&amp;quot;  &amp;quot;CDW&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once the data has been downloaded and stored into a new environment I clean the data up a little, put all the lists into a single data frame, compute the daily returns for each asset and create the &lt;em&gt;up&lt;/em&gt; or &lt;em&gt;down&lt;/em&gt; direction which will be what the classification model will try to predict.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df &amp;lt;- eapply(dataEnv, function(x){
  as.data.frame(x) %&amp;gt;% 
    rename_all(function(n){
      gsub(&amp;quot;^(\\w+)\\.&amp;quot;, &amp;quot;&amp;quot;, n, perl = TRUE)
    }
    ) %&amp;gt;%
    rownames_to_column(&amp;quot;date&amp;quot;)  
}) %&amp;gt;% 
  rbindlist(idcol = TRUE) %&amp;gt;% 
  mutate(date = as.Date(date)) %&amp;gt;% 
  group_by(.id) %&amp;gt;% 
  tq_mutate(
    select = Adjusted,
    mutate_fun = periodReturn,
    period = &amp;quot;daily&amp;quot;,
    type = &amp;quot;arithmetic&amp;quot;
  ) %&amp;gt;% 
  mutate(
    Adj_lag = lag(Adjusted),
    chng_Adj = ifelse(Adjusted &amp;gt; Adj_lag, 1, 0) # more simply we could have just done if ret were pos/neg
  ) %&amp;gt;% 
  select(&amp;quot;date&amp;quot;, &amp;quot;.id&amp;quot;, &amp;quot;Adjusted&amp;quot;, &amp;quot;daily.returns&amp;quot;, &amp;quot;chng_Adj&amp;quot;, &amp;quot;Open&amp;quot;, &amp;quot;High&amp;quot;, &amp;quot;Low&amp;quot;, &amp;quot;Close&amp;quot;) %&amp;gt;% 
  as_tibble() %&amp;gt;% 
  as_tbl_time(index = date) %&amp;gt;% 
  setNames(c(&amp;quot;date&amp;quot;, &amp;quot;ID&amp;quot;, &amp;quot;prc&amp;quot;, &amp;quot;ret&amp;quot;, &amp;quot;chng&amp;quot;, &amp;quot;open&amp;quot;, &amp;quot;high&amp;quot;, &amp;quot;low&amp;quot;, &amp;quot;close&amp;quot;)) %&amp;gt;% 
  drop_na(chng)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The first few observations of the data looks like:&lt;/p&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
date
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
ID
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
prc
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
ret
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
chng
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
open
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
high
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
low
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
close
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2017-01-04
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
50.63446
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0162981
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.79
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
52.60
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.79
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
52.38
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2017-01-05
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
50.14147
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0097364
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
52.10
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
52.66
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.84
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.87
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2017-01-06
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
49.96746
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0034704
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.89
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.95
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.46
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
51.69
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;We can use the &lt;code&gt;nest()&lt;/code&gt; function to put the data into convenient nested tibbles that we can simply &lt;code&gt;map()&lt;/code&gt; over and apply the &lt;code&gt;rolling_origin()&lt;/code&gt; function from the &lt;code&gt;rsample&lt;/code&gt; package such that, each of our assets will have their own &lt;code&gt;rolling_origin()&lt;/code&gt; function applied to it without any overlap or mixing of the asset classes, I do this in order to create the time series features for each period.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;nested_df &amp;lt;- df %&amp;gt;%
  mutate(duplicate_ID = ID) %&amp;gt;% 
  nest(-ID)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I split the time series data into a number of lists such that the &lt;code&gt;analysis()&lt;/code&gt; list contains 100 observations in each list and has a corresponding &lt;code&gt;assessment()&lt;/code&gt; list which contains 1 observation. Usually the &lt;code&gt;analysis()&lt;/code&gt; will become our training data set and the &lt;code&gt;assessment()&lt;/code&gt; will become our testing data set, however, here I am using the &lt;code&gt;rolling_origin()&lt;/code&gt; function to help create the time series features.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# First we set the number of days we want to construct the ts features
rolled_df &amp;lt;- map(nested_df$data, ~ rolling_origin(.,
                                                  initial = 100,
                                                  assess = 1,
                                                  cumulative = FALSE,
                                                  skip = 0))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;time-series-functions&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Time-Series Functions&lt;/h2&gt;
&lt;p&gt;In order to create the time series variables I use the &lt;code&gt;tsfeatures&lt;/code&gt; package but there is also the &lt;code&gt;feasts&lt;/code&gt; packages &lt;a href=&#34;http://feasts.tidyverts.org/&#34;&gt;here&lt;/a&gt;. For this model I simply select a few functions of interest from the &lt;code&gt;tsfeatures&lt;/code&gt; package.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;functions &amp;lt;- c(
  &amp;quot;entropy&amp;quot;,                   # Measures the &amp;quot;forecastability&amp;quot; of a series - low values = high sig-to-noise, large vals = difficult to forecast
  &amp;quot;stability&amp;quot;,                 # means/variances are computed for all tiled windows - stability is the variance of the means
  &amp;quot;lumpiness&amp;quot;,                 # Lumpiness is the variance of the variances
  &amp;quot;max_level_shift&amp;quot;,           # Finds the largest mean shift between two consecutive windows (returns two values, size of shift and time index of shift)
  &amp;quot;max_var_shift&amp;quot;,             # Finds the max variance shift between two consecutive windows (returns two values, size of shift and time index of shift)
  &amp;quot;max_kl_shift&amp;quot;,              # Finds the largest shift in the Kulback-Leibler divergence between two consecutive windows (returns two values, size of shift and time index of shift)
  &amp;quot;crossing_points&amp;quot;            # Number of times a series crosses the mean line
)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I wrote this code a little while ago and at the time I wrapped the model into a function. I think it would be more fun to exclusively stick to using just &lt;code&gt;map()&lt;/code&gt; functions instead of &lt;code&gt;function(SYMB)&lt;/code&gt;. The function does the following for each asset in our data:&lt;/p&gt;
&lt;p&gt;Using the out-of-sample &lt;code&gt;t+1&lt;/code&gt; (&lt;code&gt;assessment&lt;/code&gt;) data, bind these lists together into a single data frame. Next apply the &lt;code&gt;functions&lt;/code&gt; character string to call the functions from the &lt;code&gt;tsfeatures&lt;/code&gt; package, apply these functions to the in-sample (&lt;code&gt;analysis&lt;/code&gt;) data (which consists of 100 observations each), such that, we obtain a single &lt;em&gt;collapsed&lt;/em&gt; down observation that we can just bind together. Finally we bind the columns of these two data sets together using &lt;code&gt;bind_cols()&lt;/code&gt;. After this I rename the &lt;code&gt;chng&lt;/code&gt; variable and rename the time series feature variables to something more dynamic using &lt;code&gt;~str_c(&#34;X&#34;, seq_along(.))&lt;/code&gt; so we can just add functions to the &lt;code&gt;functions&lt;/code&gt; character string and not have to worry about renaming the variables individually in order for the model to work.&lt;/p&gt;
&lt;p&gt;Once this is done, I create the Machine Learning data set again using the &lt;code&gt;rolling_origin()&lt;/code&gt; function. The first &lt;code&gt;rolling_origin()&lt;/code&gt; function was used to help &lt;em&gt;collapse&lt;/em&gt; the time series data down on a rolling basis by taking the previous 100 days of data and calculating the &lt;code&gt;tsfeatures&lt;/code&gt; function on it - &lt;em&gt;a similar method to calculating a rolling mean/sd using the &lt;code&gt;rollapply()&lt;/code&gt; function from the &lt;code&gt;zoo&lt;/code&gt; package&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;I next split the data into &lt;code&gt;X&lt;/code&gt; variables with &lt;code&gt;X_train&lt;/code&gt; and &lt;code&gt;X_test&lt;/code&gt; and the corresponding &lt;code&gt;Y&lt;/code&gt; variable with &lt;code&gt;Y_train&lt;/code&gt; and &lt;code&gt;Y_test&lt;/code&gt;. The package &lt;code&gt;xgboost&lt;/code&gt; expects a certain type of &lt;code&gt;xgb.DMatrix()&lt;/code&gt; which is what &lt;code&gt;dtrain&lt;/code&gt; and &lt;code&gt;dtest&lt;/code&gt; are doing.&lt;/p&gt;
&lt;p&gt;Then, I set the XGBoost parameters and apply the XGBoost model. - &lt;em&gt;Suitable cross validation should be performed at this point, however I will leave this for another post since time series cross validation is quite tricky and there is no function in R which helps with this type of cross validation (that I have found as of 2020-02-02)&lt;/em&gt; -&lt;/p&gt;
&lt;p&gt;Once the model has been trained, I make the predictions.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;apply-the-model&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Apply the model&lt;/h2&gt;
&lt;p&gt;The function to compute all this is the following:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;Prediction_Model &amp;lt;- function(SYMB){
  data &amp;lt;- bind_cols(
    map(rolled_df[[SYMB]]$splits, ~ assessment(.x)) %&amp;gt;%
      bind_rows(),
    map(rolled_df[[SYMB]]$splits, ~ analysis(.x)) %&amp;gt;%
      map(., ~tsfeatures(.x[[&amp;quot;ret&amp;quot;]], functions)) %&amp;gt;%          # Compute the TSFeatures
      bind_rows()
  ) %&amp;gt;%
    rename(Y = chng) %&amp;gt;%
    rename_at(vars(-c(1:9)), ~str_c(&amp;quot;X&amp;quot;, seq_along(.)))        
  
  ml_data &amp;lt;- data %&amp;gt;% 
    as_tibble() %&amp;gt;% 
    rolling_origin(
      initial    = 200,
      assess     = 1,
      cumulative = FALSE,
      skip       = 0)
  
  X_train &amp;lt;- map(
    ml_data$splits, ~ analysis(.x) %&amp;gt;%
      as_tibble(., .name_repair = &amp;quot;universal&amp;quot;) %&amp;gt;%
      select(starts_with(&amp;quot;X&amp;quot;)) %&amp;gt;% 
      as.matrix()
  )
  
  Y_train &amp;lt;- map(
    ml_data$splits, ~ analysis(.x) %&amp;gt;%
      as_tibble(., .name_repair = &amp;quot;universal&amp;quot;) %&amp;gt;%
      select(starts_with(&amp;quot;Y&amp;quot;)) %&amp;gt;% 
      as.matrix()
  )
  
  X_test &amp;lt;- map(
    ml_data$splits, ~ assessment(.x) %&amp;gt;%
      as_tibble(., .name_repair = &amp;quot;universal&amp;quot;) %&amp;gt;%
      select(starts_with(&amp;quot;X&amp;quot;)) %&amp;gt;% 
      as.matrix()
  )
  
  Y_test &amp;lt;- map(
    ml_data$splits, ~ assessment(.x) %&amp;gt;%
      as_tibble(., .name_repair = &amp;quot;universal&amp;quot;) %&amp;gt;%
      select(starts_with(&amp;quot;Y&amp;quot;)) %&amp;gt;% 
      as.matrix()
  )
  
  #############################################################
  
  dtrain &amp;lt;- map2(
    X_train, Y_train, ~ xgb.DMatrix(data = .x, label = .y, missing = &amp;quot;NaN&amp;quot;)
  )
  
  dtest &amp;lt;- map(
    X_test, ~ xgb.DMatrix(data = .x, missing = &amp;quot;NaN&amp;quot;)
  )
  
  # Parameters:
  watchlist &amp;lt;- list(&amp;quot;train&amp;quot; = dtrain)
  params &amp;lt;- list(&amp;quot;eta&amp;quot; = 0.1, &amp;quot;max_depth&amp;quot; = 5, &amp;quot;colsample_bytree&amp;quot; = 1, &amp;quot;min_child_weight&amp;quot; = 1, &amp;quot;subsample&amp;quot;= 1,
                 &amp;quot;objective&amp;quot;=&amp;quot;binary:logistic&amp;quot;, &amp;quot;gamma&amp;quot; = 1, &amp;quot;lambda&amp;quot; = 1, &amp;quot;alpha&amp;quot; = 0, &amp;quot;max_delta_step&amp;quot; = 0,
                 &amp;quot;colsample_bylevel&amp;quot; = 1, &amp;quot;eval_metric&amp;quot;= &amp;quot;auc&amp;quot;,
                 &amp;quot;set.seed&amp;quot; = 176)
  
  # Train the XGBoost model
  xgb.model &amp;lt;- map(
    dtrain, ~ xgboost(params = params, data = .x, nrounds = 10, watchlist)
  )
  
  xgb.pred &amp;lt;- map2(
    .x = xgb.model, 
    .y = dtest, 
    .f = ~ predict(.x, newdata = .y, type = &amp;#39;prob&amp;#39;)
  )
  
  preds &amp;lt;- cbind(plyr::ldply(xgb.pred, data.frame),
                 plyr::ldply(Y_test, data.frame)) %&amp;gt;% 
    setNames(c(&amp;quot;pred_probs&amp;quot;, &amp;quot;actual&amp;quot;)) %&amp;gt;% 
    bind_cols(plyr::ldply(map(ml_data$splits, ~assessment(.x)))) %&amp;gt;% 
    rename(ID = duplicate_ID) %&amp;gt;% 
    #select(pred_probs, actual, date, ID, prc, ret) %&amp;gt;% 
    as_tibble()
  return(preds)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can apply the above model to create the time series features, train and test on each of our assets by running the following.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;Sys_t_start &amp;lt;- Sys.time()
Resultados &amp;lt;- lapply(seq(1:length(rolled_df)), Prediction_Model)
Sys_t_end &amp;lt;- Sys.time()
round(Sys_t_end - Sys_t_start, 2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;Resultados&lt;/code&gt; output will give us a list the length of the number of assets we have in our data. The first few observations of the first asset in the list looks like:&lt;/p&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
pred_probs
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
actual
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
date
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
prc
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
ret
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Y
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
open
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
high
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
low
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
close
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
ID
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X1
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X2
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X3
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X4
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X5
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X6
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X7
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X8
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X9
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X10
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7304490
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-15
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.17622
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0106061
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.36
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.51
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.18
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.63
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9870653
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1149955
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7047308
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.277064
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.161538
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
63
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.245055
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
76
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
56
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.5149571
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-16
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.35286
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0160795
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.78
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.99
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.04
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.83
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9886519
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0745409
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.8408280
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.273320
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.143027
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
62
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.227452
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
55
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.6207952
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-19
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
72.53889
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0243967
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.35
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.35
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.45
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.98
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9902178
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0901013
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7192391
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.275344
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.153024
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
61
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.227452
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
55
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Which consist of the XGBoost predicted probabilities, the actual observed result, the date of the result (of the out-of-sample testing data), the observed share price, the calculated daily returns, (a duplicate of the observed result), the OHLC data we collected from Yahoo and finally the time series features we constructed and then reneamed to &lt;span class=&#34;math inline&#34;&gt;\(X_{n}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;objective&lt;/strong&gt; of this strategy was to invest every day in the asset which obtained the highest predicted probability that the market was going to go up. That is, if the model predicts on day &lt;span class=&#34;math inline&#34;&gt;\(t\)&lt;/span&gt; that asset &lt;code&gt;GOOG&lt;/code&gt; was going to be higher than it’s previous close with a predicted probability of 0.78 and it also predicts that &lt;code&gt;AMZN&lt;/code&gt; would go up with 0.53 probability then we would invest in &lt;code&gt;GOOG&lt;/code&gt; today. That is, we only invest in the asset with the highest predicted probability that the market is going to go up.&lt;/p&gt;
&lt;p&gt;Therefore, I create a new data frame called &lt;code&gt;top_assets&lt;/code&gt; which basically gives me the highest predicted probability across all assets each day.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;top_assets &amp;lt;- plyr::ldply(Resultados) %&amp;gt;% 
  #select(pred_probs, actual, date, open, high, low, close, prc, ret) %&amp;gt;% 
  group_by(date) %&amp;gt;%
  arrange(desc(pred_probs)) %&amp;gt;%
  dplyr::slice(1) %&amp;gt;% 
  ungroup() %&amp;gt;% 
  select(date, everything()) %&amp;gt;% 
  rename(score = pred_probs) %&amp;gt;% 
  select(-actual)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;strategy-assessment&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Strategy Assessment&lt;/h2&gt;
&lt;p&gt;The first 10 days of the strategy investments look like:&lt;/p&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
date
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
score
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
prc
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
ret
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Y
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
open
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
high
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
low
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
close
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
ID
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X1
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X2
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X3
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X4
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X5
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X6
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X7
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X8
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X9
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
X10
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-15
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7304490
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.17622
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0106061
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.36
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.51
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.18
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.63
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9870653
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1149955
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7047308
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.2770644
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.161538
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
63
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.245055
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
76
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
56
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-16
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.6899720
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
293.04999
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0051601
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
295.13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
297.61
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
289.27
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
293.05
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ABMD
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9918187
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0769474
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.4417643
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.0584676
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
4.917599
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
62
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
7.861935
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
80
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
39
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-19
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7299674
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
101.46883
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0081591
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
108.98
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
109.06
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
107.40
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
108.19
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CCI
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9894902
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0705445
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.3788407
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9924987
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.786445
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
5
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.402126
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
89
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
46
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-20
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7370850
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
60.44966
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0132920
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
65.13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
66.10
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
65.13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
65.56
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
SLB
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9830999
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1717591
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1725298
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.1379607
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
53
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.853699
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
9
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.739650
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
10
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
47
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-21
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7003193
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
334.51999
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0448199
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
320.94
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
339.20
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
320.32
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
334.52
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CMG
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9532525
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0669860
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.4899030
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.6249110
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
67
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
4.775679
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
12.454513
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
10
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
57
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-22
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7438304
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
87.40306
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0243534
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
91.53
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
92.43
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
90.48
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
90.54
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ADI
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9796797
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0855250
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.8606480
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.4206984
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
65
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.718067
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
64
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
8.589078
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
72
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
49
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-23
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.6494384
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
237.70613
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0290578
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
253.63
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
253.99
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
244.93
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
245.26
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
GS
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9685330
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0615987
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7610257
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.1137175
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
63
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.588928
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
58
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
4.667287
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
50
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-26
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.6868502
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.18565
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0238877
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.74
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.71
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.71
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.58
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9885363
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1109430
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.5278402
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.1776141
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
64
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.688307
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
56
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.038961
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
56
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-27
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7274348
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
57.21453
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0020772
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
58.13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
58.41
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
57.16
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
57.65
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CERN
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9787359
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1971365
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.2600627
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.0608221
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
62
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.325379
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
56
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.115355
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
52
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2018-03-28
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7031060
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.56778
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0039882
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.36
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.39
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.26
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.93
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CDW
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9869206
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1328377
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.5033828
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.1567020
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
62
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.593677
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
54
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.010604
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
67
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
56
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;We can see that the column &lt;code&gt;score&lt;/code&gt; is the probability for the asset with the highest predicted probability that it’s price was going to be greater than it’s previous close. The &lt;code&gt;ID&lt;/code&gt; column gives us the asset ticker we invest in.&lt;/p&gt;
&lt;p&gt;Next I want to analyse the strategy of picking the &lt;em&gt;best&lt;/em&gt; predicted winners against the S&amp;amp;P500 bench mark and therefore download the S&amp;amp;P 500 index.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;top_assets &amp;lt;- xts(top_assets[,c(2:ncol(top_assets))], order.by = top_assets$date) # put top_assets into xts format

# Analyse strategy
getSymbols(&amp;quot;SPY&amp;quot;, 
           from = start_date, 
           to = end_date, 
           src = &amp;quot;yahoo&amp;quot;) &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;SPY&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#detach(&amp;quot;package:tsibble&amp;quot;, unload = TRUE) # tsibble clashes with the base R index() function
SPY$ret_Rb &amp;lt;- Delt(SPY$SPY.Adjusted)
SPY &amp;lt;- SPY[index(SPY) &amp;gt;= min(index(top_assets))]

RaRb &amp;lt;- cbind(top_assets, SPY)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;From here we can see how the strategy compares with the S&amp;amp;P 500. I show a number of statistics for analysing asset returns from the &lt;code&gt;PerformanceAnalytics&lt;/code&gt; package. I have not expanded the model to include short selling or construct multi-asset portfolios of the top &lt;span class=&#34;math inline&#34;&gt;\(N\)&lt;/span&gt; assets.&lt;/p&gt;
&lt;p&gt;We can plot the performance of our strategy:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;charts.PerformanceSummary(RaRb[, c(&amp;quot;ret&amp;quot;, &amp;quot;ret_Rb&amp;quot;)], geometric = FALSE, wealth.index = FALSE, 
                          main = &amp;quot;Strategy vs. Market&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/xgboost-time-series-classification-trading-strategy/XGBoost-time-series-quant-trading-strategy_files/figure-html/unnamed-chunk-15-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Take a look at the drawdown and risk metrics.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;##                             ret ret_Rb
## Sterling ratio           0.1870 0.3879
## Calmar ratio             0.2551 0.5884
## Burke ratio              0.2251 0.5344
## Pain index               0.0955 0.0283
## Ulcer index              0.1189 0.0455
## Pain ratio               0.7337 4.0290
## Martin ratio             0.5891 2.5027
## daily downside risk      0.0111 0.0066
## Annualised downside risk 0.1768 0.1044
## Downside potential       0.0054 0.0029
## Omega                    1.0722 1.1601
## Sortino ratio            0.0351 0.0714
## Upside potential         0.0058 0.0034
## Upside potential ratio   0.7027 0.6124
## Omega-sharpe ratio       0.0722 0.1601&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Take a closer look at the drawdown information.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## $ret
##         From     Trough         To   Depth Length To Trough Recovery
## 1 2018-08-31 2019-01-03 2019-09-16 -0.2746    261        85      176
## 2 2019-11-06 2019-12-03       &amp;lt;NA&amp;gt; -0.1300     39        19       NA
## 3 2019-10-01 2019-10-18 2019-10-29 -0.0810     21        14        7
## 4 2018-03-22 2018-04-20 2018-05-09 -0.0773     34        21       13
## 5 2018-08-10 2018-08-15 2018-08-20 -0.0474      7         4        3
## 
## $ret_Rb
##         From     Trough         To   Depth Length To Trough Recovery
## 1 2018-09-21 2018-12-24 2019-04-12 -0.1935    140        65       75
## 2 2019-05-06 2019-06-03 2019-06-20 -0.0662     33        20       13
## 3 2018-03-15 2018-04-02 2018-06-04 -0.0610     56        12       44
## 4 2019-07-29 2019-08-05 2019-10-25 -0.0602     64         6       58
## 5 2018-06-13 2018-06-27 2018-07-09 -0.0300     18        11        7&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Compare the returns.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chart.Boxplot(RaRb[,c(&amp;quot;ret&amp;quot;, &amp;quot;ret_Rb&amp;quot;)],  main = &amp;quot;Returns&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/xgboost-time-series-classification-trading-strategy/XGBoost-time-series-quant-trading-strategy_files/figure-html/unnamed-chunk-18-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Compare return statistics.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;table.Stats(RaRb[, c(&amp;quot;ret&amp;quot;, &amp;quot;ret_Rb&amp;quot;)]) %&amp;gt;% 
  t() %&amp;gt;% 
  kable() %&amp;gt;%
  kable_styling(bootstrap_options = c(&amp;quot;striped&amp;quot;, &amp;quot;hover&amp;quot;, &amp;quot;condensed&amp;quot;, &amp;quot;responsive&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Observations
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
NAs
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Minimum
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Quartile 1
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Median
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Arithmetic Mean
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Geometric Mean
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Quartile 3
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Maximum
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
SE Mean
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
LCL Mean (0.95)
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
UCL Mean (0.95)
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Variance
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Stdev
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Skewness
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Kurtosis
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ret
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
453
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0669
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0068
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0006
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0004
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0003
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0087
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0642
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0007
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0011
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0018
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0002
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0156
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.2542
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
2.8842
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ret_Rb
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
453
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0324
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0030
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0006
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0005
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0004
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0054
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0505
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0004
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.0004
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0013
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0001
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0091
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
-0.2949
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3.6264
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Compare Sharpe Information.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lapply(RaRb[, c(&amp;quot;ret&amp;quot;, &amp;quot;ret_Rb&amp;quot;)], function(x){SharpeRatio(x)})&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $ret
##                                       ret
## StdDev Sharpe (Rf=0%, p=95%): 0.025027498
## VaR Sharpe (Rf=0%, p=95%):    0.015346462
## ES Sharpe (Rf=0%, p=95%):     0.009618405
## 
## $ret_Rb
##                                   ret_Rb
## StdDev Sharpe (Rf=0%, p=95%): 0.05152014
## VaR Sharpe (Rf=0%, p=95%):    0.03218952
## ES Sharpe (Rf=0%, p=95%):     0.01913213&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Plot the Risk - Return scatter plot.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chart.RiskReturnScatter(RaRb[, c(&amp;quot;ret&amp;quot;, &amp;quot;ret_Rb&amp;quot;)],  # check this plot a little more
                        Rf=.03/252, scale = 252, # for daily data
                        main = &amp;quot;Risk - Return over the period&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/xgboost-time-series-classification-trading-strategy/XGBoost-time-series-quant-trading-strategy_files/figure-html/unnamed-chunk-21-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Plot the rolling return, risk and Sharpe performance.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;charts.RollingPerformance(RaRb[, c(&amp;quot;ret&amp;quot;, &amp;quot;ret_Rb&amp;quot;)],      
                          Rf=.03/12, 
                          colorset = c(&amp;quot;red&amp;quot;, rep(&amp;quot;darkgray&amp;quot;,5), &amp;quot;orange&amp;quot;, &amp;quot;green&amp;quot;), lwd = 2)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/xgboost-time-series-classification-trading-strategy/XGBoost-time-series-quant-trading-strategy_files/figure-html/unnamed-chunk-22-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Compute the yearly returns.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lapply(RaRb[, c(&amp;quot;ret&amp;quot;)],function(x){periodReturn(
  x, period = &amp;#39;yearly&amp;#39;, type = &amp;#39;arithmetic&amp;#39;)})        # change type to log for continuous&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $ret
##            yearly.returns
## 2018-12-31      -1.855083
## 2019-12-31      -1.475181&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lapply(RaRb[, c(&amp;quot;ret_Rb&amp;quot;)],function(x){periodReturn(
  x, period = &amp;#39;yearly&amp;#39;, type = &amp;#39;arithmetic&amp;#39;)})&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $ret_Rb
##            yearly.returns
## 2018-12-31     -9.0376638
## 2019-12-31     -0.7226497&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Quantitative Trading Strategies using quantmod</title>
      <link>/post/understanding-ttr-package/technical-trading-rules/</link>
      <pubDate>Sun, 29 Dec 2019 00:00:00 +0000</pubDate>
      <guid>/post/understanding-ttr-package/technical-trading-rules/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/kePrint/kePrint.js&#34;&gt;&lt;/script&gt;


&lt;div id=&#34;strategies&#34; class=&#34;section level1 tabset tabset-fade tabset-pills&#34;&gt;
&lt;h1&gt;Strategies&lt;/h1&gt;
&lt;div id=&#34;introduction&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Introduction:&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; This post is unfinished.&lt;/p&gt;
&lt;p&gt;This post goes through a number of the technical trading functions in the &lt;code&gt;TTR&lt;/code&gt; package &lt;a href=&#34;https://cran.r-project.org/web/packages/TTR/TTR.pdf&#34;&gt;here&lt;/a&gt;. I add definitions and show examples of how the functions work.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)
library(quantmod)
library(tidyquant)
library(TTR)
library(timetk)
library(tidyr)
library(ggplot2) 
library(directlabels)
library(data.table)
library(quantstrat)
library(purrr)
library(quantstrat)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can download some data using the &lt;code&gt;quantmod&lt;/code&gt; package which stores the different assets into our Global Environment.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;start_date &amp;lt;- &amp;quot;2013-01-01&amp;quot;
end_date &amp;lt;- &amp;quot;2017-08-31&amp;quot;
symbols &amp;lt;- c(&amp;quot;AAPL&amp;quot;, &amp;quot;AMD&amp;quot;, &amp;quot;ADI&amp;quot;,  &amp;quot;ABBV&amp;quot;, &amp;quot;A&amp;quot;,  &amp;quot;APD&amp;quot;, &amp;quot;AA&amp;quot;, &amp;quot;CF&amp;quot;, &amp;quot;NVDA&amp;quot;, &amp;quot;HOG&amp;quot;, &amp;quot;WMT&amp;quot;, &amp;quot;AMZN&amp;quot;
             #,&amp;quot;MSFT&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;INTC&amp;quot;, &amp;quot;ADBE&amp;quot;, &amp;quot;AMG&amp;quot;, &amp;quot;AKAM&amp;quot;, &amp;quot;ALB&amp;quot;, &amp;quot;ALK&amp;quot;
)

getSymbols(symbols, 
           from = start_date,
           to = end_date)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;AAPL&amp;quot; &amp;quot;AMD&amp;quot;  &amp;quot;ADI&amp;quot;  &amp;quot;ABBV&amp;quot; &amp;quot;A&amp;quot;    &amp;quot;APD&amp;quot;  &amp;quot;AA&amp;quot;   &amp;quot;CF&amp;quot;   &amp;quot;NVDA&amp;quot; &amp;quot;HOG&amp;quot; 
## [11] &amp;quot;WMT&amp;quot;  &amp;quot;AMZN&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The first few observations for &lt;code&gt;AAPL&lt;/code&gt; looks like:&lt;/p&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
AAPL.Open
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
AAPL.High
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
AAPL.Low
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
AAPL.Close
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
AAPL.Volume
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
AAPL.Adjusted
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-01-02
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
79.11714
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
79.28571
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
77.37572
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
78.43285
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
140129500
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.85055
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-01-03
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
78.26857
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
78.52428
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
77.28571
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
77.44286
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
88241300
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
67.98149
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-01-04
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
76.71000
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
76.94714
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.11857
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.28571
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
148583400
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
66.08789
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-01-07
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.57143
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.61429
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.60000
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.84286
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
121039100
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
65.69916
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-01-08
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.60143
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.98428
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.46429
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.04429
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
114676800
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
65.87595
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-01-09
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.64286
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
75.00143
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.71286
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.87143
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
101901100
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
64.84639
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div id=&#34;bollinger-bands-strategy&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Bollinger Bands Strategy&lt;/h2&gt;
&lt;p&gt;The idea of this strategy is&lt;/p&gt;
&lt;p&gt;Definition: A Bollinger Band consists of 3 lines. A simple moving average (SMA) and two additional lines plotted 2 standard deviations above and below the SMA. The standard deviation measures a stocks volatility and so when the markers are more volatile then the Bollinger Bands become wider. When the market is flat the Bollinger Banks contract.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chartSeries(NVDA,
            theme = chartTheme(&amp;quot;white&amp;quot;),
            TA = c(addBBands(n = 20, sd = 2, ma = &amp;quot;SMA&amp;quot;, draw = &amp;#39;bands&amp;#39;, on = -1))) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chartSeries(AMZN,
            theme = chartTheme(&amp;quot;white&amp;quot;),
            TA = c(addBBands(n = 20, sd = 2, ma = &amp;quot;SMA&amp;quot;, draw = &amp;#39;bands&amp;#39;, on = -1))) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-4-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;We set the initial quantstrat parameters and initialise the strategy.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rm.strat(&amp;quot;BollingerBandsStrat&amp;quot;)
currency(&amp;#39;USD&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;USD&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;stock(symbols, currency = &amp;#39;USD&amp;#39;, multiplier = 1)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;AAPL&amp;quot; &amp;quot;AMD&amp;quot;  &amp;quot;ADI&amp;quot;  &amp;quot;ABBV&amp;quot; &amp;quot;A&amp;quot;    &amp;quot;APD&amp;quot;  &amp;quot;AA&amp;quot;   &amp;quot;CF&amp;quot;   &amp;quot;NVDA&amp;quot; &amp;quot;HOG&amp;quot; 
## [11] &amp;quot;WMT&amp;quot;  &amp;quot;AMZN&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;init_date = as.Date(start_date) - 1
init_equity = 1000
portfolio.st &amp;lt;- account.st &amp;lt;- &amp;#39;BollingerBandsStrat&amp;#39;
initPortf(portfolio.st,
          symbols = symbols,
          initDate = init_date)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;BollingerBandsStrat&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;initAcct(account.st,
         portfolios = &amp;#39;BollingerBandsStrat&amp;#39;,
         initDate = init_date)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;BollingerBandsStrat&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;initOrders(portfolio = portfolio.st,
           initDate = init_date)
BBands_Strategy &amp;lt;- strategy(&amp;quot;BollingerBandsStrat&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;adding-indicators&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Adding indicators:&lt;/h3&gt;
&lt;p&gt;We add the Bollinger Bands indicator from the &lt;code&gt;TTR&lt;/code&gt; package to the strategy. It takes a Simple Moving Average (SMA) and the High Low Close data from each of our stocks, add the indicator to the defined &lt;code&gt;BBands_Strategy&lt;/code&gt; and creates a new column in our data alled &lt;code&gt;BollingerBands_Label&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Add indicators
BBands_Strategy &amp;lt;- add.indicator(
  strategy = BBands_Strategy,
  name = &amp;quot;BBands&amp;quot;,
  arguments = list(
    HLC = quote(HLC(mktdata)),
    maType = &amp;#39;SMA&amp;#39;),
  label = &amp;#39;BollingerBands_Label&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;adding-signals&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Adding signals:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The first signal states that when the &lt;strong&gt;close&lt;/strong&gt; is greater than the &lt;strong&gt;upper Bollinger Band&lt;/strong&gt;, add a value of 1 into a column called &lt;strong&gt;Close.gt.LowerBBand&lt;/strong&gt;. The &lt;code&gt;sigCrossover&lt;/code&gt; function only returns the first occurence of the relationship switching from false to true. Replacing with &lt;code&gt;sigComparison&lt;/code&gt; here would return all occurences of the relationship being greater than the upper band.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The second signal states that when the &lt;strong&gt;close&lt;/strong&gt; is less than the &lt;strong&gt;lower Bollinger Band&lt;/strong&gt; add a value of 1 into a column called &lt;strong&gt;Close.lt.LowerBBand&lt;/strong&gt;. Again using the &lt;code&gt;sigCrossover&lt;/code&gt; function to only return the first occurence.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The third signal&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The below code creates 3 new columns in our &lt;code&gt;mktdata&lt;/code&gt;. &lt;strong&gt;dn.BollingerBands_Label&lt;/strong&gt;, &lt;strong&gt;mavg.BollingerBands_Label&lt;/strong&gt;, &lt;strong&gt;up.BollingerBands_Label&lt;/strong&gt;. Which are the &lt;strong&gt;lower&lt;/strong&gt;, &lt;strong&gt;middle&lt;/strong&gt; and &lt;strong&gt;upper&lt;/strong&gt; Bollinger Band values. It also creates the following: &lt;strong&gt;Close.gt.UpperBBand&lt;/strong&gt;, &lt;strong&gt;Close.lt.LowerBBand&lt;/strong&gt;, &lt;strong&gt;Cross.MiddleBBand&lt;/strong&gt;. Which takes on the values according to whether the `sigCrossover’ has occured.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Add Signals

BBands_Strategy &amp;lt;- add.signal(
  BBands_Strategy, 
  name = &amp;quot;sigCrossover&amp;quot;,
  arguments = list(
    columns = c(&amp;quot;Close&amp;quot;,&amp;quot;up&amp;quot;),
    relationship = &amp;quot;gt&amp;quot;),
  label = &amp;quot;Close.gt.UpperBBand&amp;quot;)

BBands_Strategy &amp;lt;- add.signal(
  BBands_Strategy,
  name = &amp;quot;sigCrossover&amp;quot;,
  arguments = list(
    columns = c(&amp;quot;Close&amp;quot;,&amp;quot;dn&amp;quot;),
    relationship = &amp;quot;lt&amp;quot;),
  label = &amp;quot;Close.lt.LowerBBand&amp;quot;)

BBands_Strategy &amp;lt;- add.signal(
  BBands_Strategy,
  name = &amp;quot;sigCrossover&amp;quot;,
  arguments = list(
    columns = c(&amp;quot;High&amp;quot;,&amp;quot;Low&amp;quot;,&amp;quot;mavg&amp;quot;),
    relationship = &amp;quot;op&amp;quot;),
  label = &amp;quot;Cross.MiddleBBand&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;mktdata&lt;/code&gt; (which gets presented after running &lt;code&gt;applyStrategy&lt;/code&gt; and &lt;code&gt;updatePortf&lt;/code&gt;) would look like:&lt;/p&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
index
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
WMT.Open
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
WMT.High
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
WMT.Low
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
WMT.Close
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
WMT.Volume
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
WMT.Adjusted
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
dn.BollingerBands_Label
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
mavg.BollingerBands_Label
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
up.BollingerBands_Label
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
pctB.BollingerBands_Label
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Close.gt.UpperBBand
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Close.lt.LowerBBand
&lt;/th&gt;
&lt;th style=&#34;text-align:right;&#34;&gt;
Cross.MiddleBBand
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.29
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.70
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.21
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.39
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
3968600
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.98333
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.71632
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.09250
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.46868
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.9871567
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-14
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.10
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.23
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.75
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.82
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
6821000
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.50441
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.82043
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.18133
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.54224
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7762866
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-15
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.54
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.00
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.30
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
25683700
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
58.22726
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.84929
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.19050
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.53171
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1096177
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-19
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.19
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.45
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.54
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.76
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
14682300
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
57.77356
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.82222
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.18217
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.54211
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.0347239
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-20
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.72
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.85
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.30
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.21
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
11973600
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
58.15165
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.78472
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.16833
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.55195
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.1211618
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-21
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.00
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.47
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.72
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.26
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
20413100
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.03389
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.86119
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.22117
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.58114
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.5963869
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-22
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.22
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.54
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.89
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.40
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
9165200
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.15152
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
68.90249
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.24950
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.59651
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.5100843
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-25
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.50
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.34
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.44
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.44
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
11817600
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.18514
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.00983
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.32100
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.63217
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.6597812
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-26
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.69
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.39
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.61
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.11
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
10557600
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.74808
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.14416
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.41200
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.67984
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7463509
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-27
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.92
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.96
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.58
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.66
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
8819000
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
60.21020
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.20490
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.49383
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.78277
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.8515172
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-02-28
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.59
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.88
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.78
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.78
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
18883600
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
59.47081
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.28076
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.56167
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.84258
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.7283528
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-03-01
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.78
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.90
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.78
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.74
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
8902300
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
60.27741
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.33128
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.63400
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.93672
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
0.8221462
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-03-04
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.52
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.26
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.51
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.26
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
10567200
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
61.55456
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.27376
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.75150
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
72.22924
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.1513879
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-03-05
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.47
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.04
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
72.99
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.72
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
9142000
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
61.94105
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.24347
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
70.95300
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
72.66253
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.2693145
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-03-06
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.75
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
74.13
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.25
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.38
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
7149600
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
61.65540
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.17483
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.10567
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.03650
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.1424682
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2013-03-07
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.49
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.61
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.20
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.32
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
6680000
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
61.60497
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
69.14018
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
71.22567
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
73.31116
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
1.0157056
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;td style=&#34;text-align:right;&#34;&gt;
NA
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;In row 4 of the below table, the &lt;strong&gt;close&lt;/strong&gt; is 68.76 which is less than the &lt;strong&gt;lower Bollinger Band&lt;/strong&gt; &lt;strong&gt;dn.BollingerBands_Label&lt;/strong&gt; column 68.822 and a &lt;code&gt;1&lt;/code&gt; is indicated in the &lt;strong&gt;Close.lt.LowerBBand&lt;/strong&gt; column. In row 13 of the same data, there is a &lt;code&gt;1&lt;/code&gt; in the column &lt;strong&gt;Close.gt.UpperBBand&lt;/strong&gt;. The &lt;strong&gt;close&lt;/strong&gt; is 73.26 and the &lt;strong&gt;up.BollingerBands_Label&lt;/strong&gt; is 72.23 so the &lt;strong&gt;close&lt;/strong&gt; is &lt;strong&gt;gt&lt;/strong&gt; then &lt;strong&gt;Upper Bollinger Band&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;add-the-rules&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Add the rules&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;When the &lt;strong&gt;close&lt;/strong&gt; is greater than the &lt;strong&gt;upper Bollinger Band&lt;/strong&gt; we go short by a quantity of 100 at the market price&lt;/li&gt;
&lt;li&gt;When the &lt;strong&gt;close&lt;/strong&gt; is lower than the &lt;strong&gt;lower Bollinger Band&lt;/strong&gt; we go long by a quantity of 100 at the market price.&lt;/li&gt;
&lt;li&gt;When the &lt;strong&gt;Close&lt;/strong&gt; crosses the &lt;strong&gt;middle Bollinger Band&lt;/strong&gt; we exit all our positions.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Add rules

BBands_Strategy &amp;lt;- add.rule(
  BBands_Strategy,
  name = &amp;#39;ruleSignal&amp;#39;,
  arguments = list(
    sigcol = &amp;quot;Close.gt.UpperBBand&amp;quot;, 
    sigval = TRUE, 
    orderqty = -100, 
    ordertype = &amp;#39;market&amp;#39;,
    orderside = NULL,
    threshold = NULL),
  type = &amp;#39;enter&amp;#39;)

BBands_Strategy &amp;lt;- add.rule(
  BBands_Strategy, 
  name = &amp;#39;ruleSignal&amp;#39;,
  arguments = list(
    sigcol = &amp;quot;Close.lt.LowerBBand&amp;quot;,
    sigval = TRUE,
    orderqty = 100,
    ordertype = &amp;#39;market&amp;#39;,
    orderside = NULL,
    threshold = NULL),
  type = &amp;#39;enter&amp;#39;)

BBands_Strategy &amp;lt;- add.rule(
  BBands_Strategy,
  name = &amp;#39;ruleSignal&amp;#39;,
  arguments = list(
    sigcol = &amp;quot;Cross.MiddleBBand&amp;quot;,
    sigval = TRUE,
    orderqty = &amp;#39;all&amp;#39;,
    ordertype = &amp;#39;market&amp;#39;,
    orderside = NULL,
    threshold = NULL),
  type = &amp;#39;exit&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Apply the strategy and update the portfolio&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;out &amp;lt;- applyStrategy(
  strategy = BBands_Strategy,
  portfolios = &amp;#39;BollingerBandsStrat&amp;#39;,
  parameters = list( 
    sd = 1.6, # number of standard deviations
    n = 20) # MA periods
  )

updatePortf(Portfolio = &amp;#39;BollingerBandsStrat&amp;#39;, Dates = paste(&amp;#39;::&amp;#39;,as.Date(Sys.time()),sep=&amp;#39;&amp;#39;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Find the best performance stocks:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tradeStats(portfolio.st) %&amp;gt;% 
  tibble::rownames_to_column(&amp;quot;ticker&amp;quot;) %&amp;gt;%
  t() %&amp;gt;% 
  kable() %&amp;gt;%
  kable_styling(bootstrap_options = c(&amp;quot;striped&amp;quot;, &amp;quot;hover&amp;quot;, &amp;quot;condensed&amp;quot;, &amp;quot;responsive&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;table class=&#34;table table-striped table-hover table-condensed table-responsive&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ticker
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
A
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AA
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AAPL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ABBV
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ADI
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AMD
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AMZN
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
APD
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CF
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
HOG
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
NVDA
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
WMT
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Portfolio
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
BollingerBandsStrat
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Symbol
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
A
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AA
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AAPL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ABBV
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ADI
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AMD
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
AMZN
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
APD
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
CF
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
HOG
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
NVDA
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
WMT
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Num.Txns
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
181
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
188
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
163
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
182
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
172
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
165
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
176
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
171
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
175
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
182
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
201
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
184
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Num.Trades
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
70
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
68
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
57
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
63
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
67
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
64
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
62
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
71
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
71
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
68
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
73
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
66
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Net.Trading.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3302.7855
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-663.6981
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-5547.4283
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-288.0025
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1756.0009
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
966.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
34942.0472
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
8510.1655
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
7601.2010
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
4524.0020
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2515.9992
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3987.0002
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Avg.Trade.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
48.525511
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-6.774974
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-97.323304
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2.285762
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
26.208969
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
16.046875
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
529.436174
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
119.861486
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
107.059169
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
66.529441
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-34.465742
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
60.545452
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Med.Trade.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
66.88130
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
76.89585
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
159.99990
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
77.00000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
84.99980
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
18.50000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1180.00030
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
148.01180
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
129.00010
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
122.99995
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
35.00000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
42.00020
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Largest.Winner
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
711.7301
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
995.0003
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
965.1434
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
920.9999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1265.0001
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
152.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
9117.9932
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1882.5164
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
939.4002
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1174.0003
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1655.0003
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1356.0006
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Largest.Loser
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-528.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3104.6764
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-11317.0036
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1817.0016
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2617.0005
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-414.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-13718.9819
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1626.9989
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-903.9999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1227.0002
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-4844.0012
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1395.0009
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Gross.Profits
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
6415.110
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
8216.008
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
15231.716
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
8640.999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
9168.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2080.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
96296.006
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
16046.256
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
11782.200
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
11733.502
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
11577.998
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
9388.999
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Gross.Losses
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3018.324
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-8676.707
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-20779.144
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-8785.002
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-7411.999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1053.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-63470.963
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-7536.091
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-4180.999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-7209.500
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-14093.998
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-5392.999
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Std.Dev.Trade.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
175.69143
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
525.90402
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1607.09458
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
413.50580
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
444.63931
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
80.12096
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3565.68276
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
463.03163
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
276.80923
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
404.27517
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
794.13687
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
370.13593
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Std.Err.Trade.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
20.99914
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
63.77523
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
212.86488
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
52.09683
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
54.32134
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
10.01512
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
452.84216
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
54.95174
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
32.85121
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
49.02557
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
92.94669
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
45.56058
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Percent.Positive
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
65.71429
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
72.05882
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
68.42105
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
66.66667
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
71.64179
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
78.12500
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
67.74194
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
67.60563
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
76.05634
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
64.70588
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
61.64384
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
72.72727
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Percent.Negative
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
34.28571
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
27.94118
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
31.57895
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
33.33333
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
28.35821
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
20.31250
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
32.25806
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
32.39437
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
23.94366
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
35.29412
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
38.35616
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
25.75758
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Profit.Factor
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.1253880
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.9469040
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.7330290
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.9836081
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.2369133
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.9753086
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.5171663
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.1292547
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.8180346
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.6275056
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.8214843
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.7409606
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Avg.Win.Trade
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
139.4589
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
167.6736
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
390.5568
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
205.7381
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
191.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
41.6000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2292.7620
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
334.2970
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
218.1889
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
266.6705
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
257.2889
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
195.6041
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Med.Win.Trade
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
111.23030
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
93.71700
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
410.00060
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
189.00015
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
132.49990
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
31.00000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1834.00115
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
223.84460
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
179.20000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
180.99995
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
91.99980
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
98.99985
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Avg.Losing.Trade
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-125.7635
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-456.6688
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1154.3969
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-418.3334
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-390.1052
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-81.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3173.5481
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-327.6561
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-245.9411
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-300.3958
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-503.3571
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-317.2352
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Med.Losing.Trade
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-93.50035
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-129.76180
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-400.99975
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-288.99940
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-142.00030
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-33.00000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1961.00005
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-205.00030
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-166.99940
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-155.50005
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-138.99980
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-136.00040
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Avg.Daily.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
48.525511
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-6.774974
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-97.323304
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2.285762
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
26.208969
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
16.046875
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
529.436174
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
119.861486
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
107.059169
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
66.529441
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-34.465742
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
60.545452
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Med.Daily.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
66.88130
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
76.89585
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
159.99990
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
77.00000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
84.99980
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
18.50000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1180.00030
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
148.01180
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
129.00010
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
122.99995
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
35.00000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
42.00020
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Std.Dev.Daily.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
175.69143
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
525.90402
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1607.09458
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
413.50580
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
444.63931
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
80.12096
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3565.68276
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
463.03163
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
276.80923
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
404.27517
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
794.13687
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
370.13593
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Std.Err.Daily.PL
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
20.99914
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
63.77523
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
212.86488
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
52.09683
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
54.32134
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
10.01512
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
452.84216
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
54.95174
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
32.85121
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
49.02557
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
92.94669
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
45.56058
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Ann.Sharpe
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
4.38449749
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.20450380
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.96133704
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.08775051
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.93571231
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3.17939560
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.35706295
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
4.10931348
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
6.13964943
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.61238437
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.68895769
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.59669262
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Max.Drawdown
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1221.745
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-4652.209
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-12870.005
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-4976.003
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3965.999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-669.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-48292.017
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2705.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1757.999
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3237.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-14917.000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3010.999
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Profit.To.Max.Draw
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2.70333546
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.14266301
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.43103544
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.05787828
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.44276383
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.44394619
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.72355742
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3.14608694
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
4.32378029
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.39759098
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-0.16866657
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.32414540
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Avg.WinLoss.Ratio
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.1088981
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.3671669
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.3383211
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.4918040
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.4896115
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.5135802
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.7224601
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.0202679
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.8871590
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.8877303
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.5111458
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.6165902
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Med.WinLoss.Ratio
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.1896244
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.7222233
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.0224460
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.6539811
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.9330959
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.9393939
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.9352377
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.0919233
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.0730577
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1.1639864
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.6618700
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.7279379
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Max.Equity
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3659.7860
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1090.9615
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
6834.5749
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
607.9984
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2919.9995
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1058.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
37225.0306
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
9494.1666
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
7601.2010
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
6193.0030
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
2511.9993
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
4036.9994
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Min.Equity
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-555.0795
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-3561.2473
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-6035.4303
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-4687.0026
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1045.9995
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-101.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-11066.9863
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-848.2877
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-1744.5987
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-847.9955
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-12405.0003
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2489.9988
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
End.Equity
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3302.7855
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-663.6981
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-5547.4283
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-288.0025
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
1756.0009
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
966.0000
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
34942.0472
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
8510.1655
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
7601.2010
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
4524.0020
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
-2515.9992
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
3987.0002
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Performance plots and trade statistics&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;for(sym in symbols){
  chart.Posn(Portfolio = &amp;#39;BollingerBandsStrat&amp;#39;, Symbol = sym)
  plot(add_BBands(on = 1, sd = 1.6, n = 20))
  
  perf &amp;lt;- tradeStats(portfolio.st) %&amp;gt;% 
    tibble::rownames_to_column(&amp;quot;ticker&amp;quot;) %&amp;gt;% 
    filter(ticker == sym) %&amp;gt;% 
    t() %&amp;gt;% 
    kable() %&amp;gt;%
    kable_styling(bootstrap_options = c(&amp;quot;striped&amp;quot;, &amp;quot;hover&amp;quot;, &amp;quot;condensed&amp;quot;, &amp;quot;responsive&amp;quot;))
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-2.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-3.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-4.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-5.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-6.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-7.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-8.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-9.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-10.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-11.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-12.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-13.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-14.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-15.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-16.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-17.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-18.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-19.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-20.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-21.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-22.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-23.png&#34; width=&#34;672&#34; /&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-12-24.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Zooming in one some of the charts, it’s possible to see when we entered and exited each trade.&lt;/p&gt;
&lt;div id=&#34;here---everything-works.-chart.posn-plots-each-plot-in-sequence-find-a-way-to-plot-it-in-one-instance.&#34; class=&#34;section level9&#34;&gt;
&lt;p&gt;Here - everything works. chart.posn plots each plot in sequence find a way to plot it in one instance.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chart.Posn(Portfolio = &amp;#39;BollingerBandsStrat&amp;#39;, Symbol = &amp;quot;AMD&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(add_BBands(on = 1, sd = 1.6, n = 20))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;zoom_Chart(&amp;#39;2017-01::2017-03&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chart.Posn(Portfolio = &amp;#39;BollingerBandsStrat&amp;#39;, Symbol = &amp;quot;WMT&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-4.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(add_BBands(on = 1, sd = 1.6, n = 20))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-5.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;zoom_Chart(&amp;#39;2017-01::2017-03&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-6.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;chart.Posn(Portfolio = &amp;#39;BollingerBandsStrat&amp;#39;, Symbol = &amp;quot;AMZN&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-7.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(add_BBands(on = 1, sd = 1.6, n = 20))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-8.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;zoom_Chart(&amp;#39;2017-01::2017-03&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/understanding-ttr-package/technical-trading-rules_files/figure-html/unnamed-chunk-13-9.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;adx-directional-movement-index&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;ADX: Directional Movement Index&lt;/h2&gt;
&lt;p&gt;The Directional Movement Index (DMI) &lt;span class=&#34;citation&#34;&gt;Wilder (&lt;a href=&#34;#ref-wilder1978new&#34; role=&#34;doc-biblioref&#34;&gt;1978&lt;/a&gt;)&lt;/span&gt; tries to identify the direction an asset is moving towards through comparing previous highs and lows. It trys to determine if an asset is trending and to measure the strength of that trend. It has four components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Positive Direction Indicator (+DI): Computes the difference between todays high and the previous days high. - Helps identify the presence of an uptrend.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Negative Direction Indicator (-DI): Computes the difference between todays low and the previous days low. - Helps identify the presence of a downtrend.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Average Directional Index (ADX): A smoothed average of the difference of the +DI and -DI.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Average Directional Rating (ADXR): Simple average of todays ADX and the ADX from 14 or n periods previously.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The ADX is relative to its own asset price. An ADX of 60 for &lt;span class=&#34;math inline&#34;&gt;\(Asset_{i}\)&lt;/span&gt; is different to an ADX for &lt;span class=&#34;math inline&#34;&gt;\(Asset_{j}\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Using the &lt;code&gt;TTR&lt;/code&gt; package along with the &lt;code&gt;tidyquant&lt;/code&gt; package in R we can calculate the &lt;code&gt;ADX&lt;/code&gt; using:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# adx_calc &amp;lt;- asset_prices %&amp;gt;% 
#   group_by(symbol) %&amp;gt;% 
#   tq_mutate(
#     select = c(&amp;quot;high&amp;quot;, &amp;quot;low&amp;quot;, &amp;quot;close&amp;quot;),
#     mutate_fun = ADX,
#     n = 14,
#     maType = &amp;quot;SMA&amp;quot;
#     )

# adx_calc %&amp;gt;% 
#   group_by(symbol) %&amp;gt;% 
#   drop_na() %&amp;gt;% 
#   slice(1:5)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The first few observations of each of the assets looks like:&lt;/p&gt;
&lt;p&gt;Where the newely created columns are defined as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;DIp&lt;/code&gt;: Directional Index positive&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DIn&lt;/code&gt;: Directional Index negative&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DX&lt;/code&gt;: Directional Index&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ADX&lt;/code&gt;: Average Directional Index which takes on values between 0 and 100&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As defined previously.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;adx-trend-strength&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;ADX Trend Strength&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;ADX Value&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Strength&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;0-25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Weak Trend&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;26-50&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Strong Trend&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;51-75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Very Strong&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;76-100&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Strongestng&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;We can plot the ADX using the following, where I first put the Directional Index columns to longer format using the &lt;code&gt;pivot_longer&lt;/code&gt; function and then take a random sample of the grouped data using a combination of &lt;code&gt;group_by&lt;/code&gt;, &lt;code&gt;nest&lt;/code&gt; and &lt;code&gt;sample_n&lt;/code&gt;. Finally I filter the data between a period of 3 months and use &lt;code&gt;ggplot&lt;/code&gt; to plot the data.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# adx_calc %&amp;gt;% 
#   pivot_longer(
#     cols = c(&amp;quot;DIp&amp;quot;, &amp;quot;DIn&amp;quot;, &amp;quot;ADX&amp;quot;),
#     names_to = &amp;quot;Indicator&amp;quot;,
#     values_to = &amp;quot;Indicator_value&amp;quot;
#     ) %&amp;gt;%  
#   group_by(symbol) %&amp;gt;%
#   nest() %&amp;gt;%
#   ungroup() %&amp;gt;% 
#   sample_n(2) %&amp;gt;%
#   unnest() %&amp;gt;% 
#   filter(date &amp;gt; &amp;quot;2014-09-01&amp;quot; &amp;amp; date &amp;lt; &amp;quot;2015-01-01&amp;quot;) %&amp;gt;% 
#   ggplot(aes(x = date, y = Indicator_value, color = Indicator)) +
#   geom_line() +
#   geom_dl(aes(label = Indicator), method = list(dl.combine(&amp;quot;first.points&amp;quot;, &amp;quot;last.points&amp;quot;))) +
#   facet_wrap(~symbol, scales = &amp;quot;free&amp;quot;) +
#   theme_tq()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can create a simple trading strategy based on the &lt;code&gt;ADX&lt;/code&gt; by:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Adding a buy signal when the &lt;code&gt;DIp&lt;/code&gt; is greater than the &lt;code&gt;DIn&lt;/code&gt; and also when the &lt;code&gt;ADX&lt;/code&gt; is greater than 30.&lt;/li&gt;
&lt;li&gt;We will hold the asset until the &lt;code&gt;DIp&lt;/code&gt; is less than the &lt;code&gt;DIn&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;This creates multiple consecutive rows of &lt;code&gt;1&lt;/code&gt;’s followed by consecutive rows of &lt;code&gt;-1&lt;/code&gt;’s. Since we cannot “buy”, “buy” and “buy” and then followed by “sell”, “sell” and “sell” we will only take the first occurrence of the first “buy” and the first “sell”. I call this &lt;code&gt;buy_here&lt;/code&gt; and &lt;code&gt;sell_here&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# adx_signals &amp;lt;- adx_calc %&amp;gt;% 
#   mutate(
#     adx_signal_buy = case_when(
#       DIp &amp;gt; DIn &amp;amp; ADX &amp;gt; 30 ~ 1,
#       TRUE ~ 0
#       ),
#     adx_signal_buy_hold_until = case_when(
#       DIp &amp;lt; DIn ~ -1,
#       TRUE ~ 0
#       )
#     ) %&amp;gt;% 
#   group_by(grp = rleid(adx_signal_buy)) %&amp;gt;% 
#   mutate(buy_here = +(all(adx_signal_buy == 1) * row_number() == 1)) %&amp;gt;%
#   ungroup %&amp;gt;%
#   group_by(grp = rleid(adx_signal_buy_hold_until)) %&amp;gt;%
#   mutate(sell_here = -1 *(all(adx_signal_buy_hold_until == -1) * row_number() == 1)) %&amp;gt;%
#   ungroup %&amp;gt;%
#   select(-grp)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;refs&#34; class=&#34;references&#34;&gt;
&lt;div id=&#34;ref-wilder1978new&#34;&gt;
&lt;p&gt;Wilder, J Welles. 1978. &lt;em&gt;New Concepts in Technical Trading Systems&lt;/em&gt;. Trend Research.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
